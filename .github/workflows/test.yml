name: TypeCheck and Lint

on:
  push:
    branches:
      - main
      - dev
  pull_request:

jobs:
  test:
    timeout-minutes: 10
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest
          bun-download-url: "https://github.com/oven-sh/bun/releases/latest/download/bun-${{runner.os == 'macOS' && 'darwin' || runner.os}}-${{ runner.arch == 'X64' && 'x64' || 'arm64' }}.zip"

      - name: Install Dependencies
        run: |
          bun install
          bunx openapi-typescript ${{ env.TOOLS_API_BASE_URL }}/openapi.json -o ./src/types/tool-apis.d.ts
        env:
          TOOLS_API_BASE_URL: ${{ secrets.TOOLS_API_BASE_URL }}

      - name: Check Project
        run: bun run lint

      - name: Test
        run: TESTING=1 bun test tests/unit --timeout 600000